version: "3.9"

services:
  writer:
    build:
      context: .
      dockerfile: writer-service/Dockerfile
    image: ibcai/robot-ingest:writer
    container_name: robot-ingest-writer
    restart: unless-stopped
    network_mode: host  # ğŸš€ å¯ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼
    volumes:
      - ./config.yml:/app/config.yml:ro
    environment:
      TZ: Asia/Shanghai

  ingest:
    build:
      context: .
      dockerfile: ingest-service/Dockerfile
    image: ibcai/robot-ingest:ingest
    container_name: robot-ingest-ingest
    restart: unless-stopped
    network_mode: host  # ğŸš€ å¯ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼
    volumes:
      - ./config.yml:/app/config.yml:ro
    environment:
      TZ: Asia/Shanghai
      LOG_LEVEL_INGEST: INFO
      # æ­¥éª¤1æµ‹è¯•ï¼šå¯ç”¨ç‰¹æ€§å¼€å…³
      INGEST_FEATURE_ENABLED: "true"
      INGEST_QUEUE_CAPACITY: "1000"
      INGEST_BATCH_SIZE: "50"
      # CFG__batch__sizeTrigger: "500"
    depends_on: [writer]

# ç§»é™¤ç½‘ç»œé…ç½®ï¼Œä¸»æœºç½‘ç»œæ¨¡å¼ä¸‹ä¸éœ€è¦
# networks:
#   robot_net:
#     driver: bridge